<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neural RPS Master | Doulet Media</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
            background-color: #f5f7fa;
            color: #2c3e50;
        }
        .choices {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        .choice {
            font-size: 60px;
            cursor: pointer;
            padding: 10px;
            border-radius: 10px;
            transition: all 0.2s;
            background-color: white;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
            width: 100px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .choice:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        #result {
            font-size: 22px;
            margin: 20px 0;
            min-height: 80px;
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        .stat {
            background-color: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .analysis {
            margin-top: 30px;
            padding: 15px;
            background-color: #2c3e50;
            color: white;
            border-radius: 8px;
            text-align: left;
        }
        .pattern-display {
            font-family: monospace;
            font-size: 16px;
            margin-top: 10px;
        }
        .footer {
            margin-top: 20px;
            color: #7f8c8d;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>Neural RPS Master</h1>
    <p>The ultimate pattern-recognition AI</p>
    
    <div class="choices">
        <div class="choice" data-choice="rock">✊</div>
        <div class="choice" data-choice="paper">✋</div>
        <div class="choice" data-choice="scissors">✌️</div>
    </div>
    
    <div id="result">Make your move!</div>
    
    <div class="stats">
        <div class="stat">
            <h3>Games</h3>
            <p id="games">0</p>
        </div>
        <div class="stat">
            <h3>You</h3>
            <p id="wins">0</p>
        </div>
        <div class="stat">
            <h3>AI</h3>
            <p id="losses">0</p>
        </div>
        <div class="stat">
            <h3>Rate</h3>
            <p id="rate">0%</p>
        </div>
    </div>
    
    <div class="analysis">
        <h3>AI Analysis</h3>
        <div id="analysis">Initializing pattern recognition...</div>
        <div class="pattern-display" id="pattern"></div>
    </div>
    
    <div class="footer">
        <p>© 2024 Doulet Media | CPU-friendly AI engine</p>
    </div>

    <script>
        // Optimized game state
        const state = {
            history: [],
            counts: {rock: 0, paper: 0, scissors: 0},
            streaks: {rock: 0, paper: 0, scissors: 0},
            lastMove: null,
            transitions: {
                rock: {rock: 0, paper: 0, scissors: 0},
                paper: {rock: 0, paper: 0, scissors: 0},
                scissors: {rock: 0, paper: 0, scissors: 0}
            },
            games: 0,
            wins: 0,
            losses: 0
        };

        // Lightweight move relationships
        const beats = {
            rock: 'scissors',
            paper: 'rock',
            scissors: 'paper'
        };
        
        const emoji = {
            rock: '✊',
            paper: '✋',
            scissors: '✌️'
        };
        
        // DOM elements
        const resultEl = document.getElementById('result');
        const analysisEl = document.getElementById('analysis');
        const patternEl = document.getElementById('pattern');

        // Event listeners
        document.querySelectorAll('.choice').forEach(choice => {
            choice.addEventListener('click', (e) => {
                const move = e.target.getAttribute('data-choice');
                play(move);
            });
        });

        function play(userMove) {
            // Update game state
            state.games++;
            state.counts[userMove]++;
            
            // Track streaks
            if (userMove === state.lastMove) {
                state.streaks[userMove]++;
            } else {
                state.streaks[userMove] = 1;
            }
            
            // Update transitions
            if (state.lastMove) {
                state.transitions[state.lastMove][userMove]++;
            }
            
            // AI makes its move
            const aiMove = getAIMove(userMove);
            
            // Determine winner
            let outcome;
            if (userMove === aiMove) {
                outcome = 'tie';
            } else if (beats[userMove] === aiMove) {
                outcome = 'win';
                state.wins++;
            } else {
                outcome = 'lose';
                state.losses++;
            }
            
            // Update history
            state.history.push(userMove);
            state.lastMove = userMove;
            
            // Keep history lean (max 50 moves)
            if (state.history.length > 50) {
                state.history.shift();
            }
            
            // Update UI
            updateUI(userMove, aiMove, outcome);
        }
        
        function getAIMove(userMove) {
            // 1. Immediate spam detection (3+ repeats)
            if (state.streaks[userMove] >= 3) {
                return beats[userMove];
            }
            
            // 2. Markov chain prediction
            if (state.lastMove && state.games > 5) {
                const predictions = state.transitions[state.lastMove];
                const total = predictions.rock + predictions.paper + predictions.scissors;
                
                if (total > 3) { // Enough data
                    let bestMove = 'rock';
                    let highest = predictions.rock;
                    
                    if (predictions.paper > highest) {
                        bestMove = 'paper';
                        highest = predictions.paper;
                    }
                    if (predictions.scissors > highest) {
                        bestMove = 'scissors';
                    }
                    
                    return beats[bestMove];
                }
            }
            
            // 3. Frequency analysis
            const total = state.games || 1;
            const rockFreq = state.counts.rock / total;
            const paperFreq = state.counts.paper / total;
            
            // Weighted random based on opponent's frequencies
            const rand = Math.random();
            if (rand < rockFreq * 0.9) return 'paper';
            if (rand < (rockFreq + paperFreq) * 0.9) return 'scissors';
            return 'rock';
        }
        
        function updateUI(userMove, aiMove, outcome) {
            // Update result
            let resultText = `${emoji[userMove]} vs ${emoji[aiMove]} - `;
            resultText += outcome === 'win' ? 'You win!' :
                         outcome === 'lose' ? 'AI wins!' : 'Tie!';
            resultEl.textContent = resultText;
            
            // Update stats
            document.getElementById('games').textContent = state.games;
            document.getElementById('wins').textContent = state.wins;
            document.getElementById('losses').textContent = state.losses;
            document.getElementById('rate').textContent = 
                Math.round((state.losses / state.games) * 100) + '%';
            
            // Update analysis
            updateAnalysis();
        }
        
        function updateAnalysis() {
            if (state.games < 3) {
                analysisEl.textContent = 'Learning your patterns...';
                return;
            }
            
            let analysis = '';
            
            // Detect spam
            for (const move in state.streaks) {
                if (state.streaks[move] >= 3) {
                    analysis += `You're repeating ${move}! `;
                }
            }
            
            // Frequency analysis
            const total = state.games;
            analysis += `You play: R ${Math.round(state.counts.rock/total*100)}%, `;
            analysis += `P ${Math.round(state.counts.paper/total*100)}%, `;
            analysis += `S ${Math.round(state.counts.scissors/total*100)}%`;
            
            analysisEl.textContent = analysis;
            
            // Show recent pattern
            patternEl.textContent = state.history.slice(-10).join(' → ');
        }
    </script>
</body>
</html>
